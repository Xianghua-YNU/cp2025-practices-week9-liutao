# 迭代函数系统(IFS)分形实验报告

## 实验目的

1. 理解迭代函数系统(IFS)的基本原理和算法
2. 掌握"混沌游戏"随机迭代方法
3. 实现巴恩斯利蕨和概率树的生成
4. 分析不同参数对分形图形的影响

## 实验过程

### 1. 核心算法实现

**IFS参数定义**:
- 巴恩斯利蕨: 4个仿射变换(茎干、小叶片、左右大叶片)
- 概率树: 3个仿射变换(树干、左右分支)

**混沌游戏算法**:
1. 初始化起始点
2. 随机选择变换(按概率)
3. 应用仿射变换生成新点
4. 重复迭代生成点集
# 混沌游戏算法核心实现
```
def run_ifs(ifs_params, num_points=100000, num_skip=100):
    probs = [param[6] for param in ifs_params]
    trans_indices = np.random.choice(len(ifs_params), size=num_points+num_skip, p=probs)
    x, y = 0.0, 0.0
    points = []
    for i, idx in enumerate(trans_indices):
        a, b, c, d, e, f, _ = ifs_params[idx]
        x_new = a * x + b * y + e
        y_new = c * x + d * y + f
        x, y = x_new, y_new
        if i >= num_skip:
            points.append([x, y])
    return np.array(points)
```
### 2. 分形实现

**巴恩斯利蕨参数**:
- 茎干变换: 概率0.01
- 小叶片变换: 概率0.85
- 左右大叶片变换: 各概率0.07

**概率树参数**:
- 树干变换: 概率0.10
- 左右分支变换: 各概率0.45

### 3. 遇到的问题与解决
1. **问题**：生成的巴恩斯利蕨茎干部分不连续。  
   **原因**：茎干变换的概率设置过低（初始为0.01），导致采样点不足。  
   **解决**：保持概率参数不变，但增加总点数至200,000，茎干部分变得清晰。  

2. **问题**：概率树的左右分支不对称。  
   **原因**：左右分支变换矩阵参数的小数精度误差。  
   **解决**：检查矩阵参数，确保左右变换的旋转角度严格为±45°，调整参数后分支对称性改善。  

3. **问题**：绘图时点云显示模糊。  
   **原因**：`matplotlib`默认散点尺寸过大导致重叠。  
   **解决**：设置`plt.scatter(s=0.1, alpha=0.5)`，提高清晰度。  

## 结果展示

### 1. 巴恩斯利蕨
[![image](https://github.com/user-attachments/assets/df5d94de-73b7-419d-8b90-454e8e32134b)
]
- 展示不同变换对应的叶片部分
- 分析概率参数对叶片密度的影响

### 2. 概率树 
[![image](https://github.com/user-attachments/assets/68944787-4551-44c2-b3fe-07865787fc42)
]
- 展示分支结构
- 分析变换参数对树形的影响

## 分析与思考

1. **IFS特性分析**
   - 仿射变换参数对图形各部分的影响
   -**缩放**：巴恩斯利蕨的T₂变换（0.85缩放）控制叶片主体生长，T₃/T₄的0.2缩放生成大叶。  
   - **旋转**：概率树的左右分支矩阵包含`±0.42`项，对应45°旋转，决定分支方向。
   - 概率参数与图形密度的关系
   - **概率与密度**：概率越高的变换生成的区域点密度越大（如蕨类的小叶片）。

2. **参数实验**
   - 修改概率参数的效果
   - 调整变换参数的效果
   - **调整蕨类茎干概率**：将T₁概率从0.01提升至0.05，茎干变粗但破坏整体比例。  
   - **修改分支旋转角度**：将概率树分支旋转角度改为30°，分支夹角变小，树形更紧凑。

3. **扩展思考**
   - 如何设计新的IFS规则生成其他分形
   - **新IFS规则设计**：通过组合缩放、剪切和平移变换，可生成雪花（Koch曲线）或山脉地形。
   - 添加颜色渐变效果的方法
   - **颜色渐变**：根据变换索引为点着色（如蕨类不同叶片用不同颜色），需在`run_ifs`中记录变换类型。
   - 性能优化方案(减少点数同时保持视觉效果)
   - **性能优化**：使用`numpy`向量化计算替代循环，点数降至50,000仍能保持视觉效果。

4. **算法比较**
   - IFS与其他分形生成方法的对比
   - **IFS vs L系统**：IFS通过概率随机生成整体形态，L系统通过确定性规则迭代生成结构化分支。
   - 随机迭代与确定性迭代的差异
   - **随机迭代 vs 确定性迭代**：随机法更适合复杂自然形态，确定性法适合规则分形（如谢尔宾斯基三角形）。
-**实验结论**：IFS通过简单的仿射变换和概率控制，能够高效生成复杂自然图形，参数微调对形态影响显著，体现了“简单规则产生复杂结果”的分形哲学。
**注：请在每一部分补充你自己的实验内容、图像、分析和关键代码。**
